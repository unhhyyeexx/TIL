# 운영체제

하드웨어를 관리하고, **응용 프로그램과 하드웨어 사이에서 인터페이스 역할**을 하며 **시스템의 자원과 동작을 제어**하는 시스템 소프트웨어

- CPU를 점유해야 할 **프로세스를 결정**
- 실제로 **CPU를 프로세스에 할당**
- 프로세스 간 **공유 자원 접근과 통신** 등을 관리

프로그램: 실행파일

CPU: 프로그램을 실행시키는 주체

프로세스: CPU가 프로그램을 실행시키고 있는 상태

core: CPU안에서 일하는 핵심 부품

### CPU란?

- **CPU**: 프로그램을 실행시키는 주체로 프로세서 라고도 한다.
- core가 많을 수록 여러 프로세스 실행이 가능하
- 주요 동작 과정
  1. 프로그램을 가져와서 (RAM -> CPU)
  2. 디코더를 사용하여 기계어로 해석해 풀어낸다(컴파일)
  3. 해석된 파일을 실행시킨다.



# 프로세스(Process)

**운영체제로부터 자원을 할당 받은 작업의 단위**

### 프로세스 동작

- 운영체제가 **여러 개의 프로세스**(멀티 프로세스)를 함께 돌리고 있다.
- **동시적/병렬적/혼합**의 방법을 이용한다.
- 운영체제는 **프로세스마다 자원을 분할**해 할당한다.

### 동시성이란?

- CPU에 코어 하나
- **여러 프로그램을 돌면서 일부분을 연속적으로 실행시키는 것(context switching)**
- 속도가 매우 빠르기 때문에 동시적으로 진행되는 것처럼 느껴지는 것

### 병렬성이란?

- CPU에 코어 여러개
- 여러 프로그램을 병렬적으로 실행시킬 수 있는 것

### 

# 스레드(Thread)

**프로세스가 할당 받은 자원을 이용하는 실행 흐름의 단위**

- 프로세스 안에서 실행되는 여러 **흐름 단위**
  - 예를 들어, 브라우저 한 탭(프로세스)안에서 음악 재생(스레드), 동영상 재생(스레드)을 할 수 있는 것
- 스레드들은 프로세스마다 **정해진 자원을 함께 사용**한다 -> 여러 스레드가 **공통된 자원에 접근**하여 조작할 경우 **에러가 발생**한다

![image-20230222220444743](%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%EC%99%80%20%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4,%EC%8A%A4%EB%A0%88%EB%93%9C.assets/image-20230222220444743-16770710880881.png)

Code: 프로그램 소스 코드 저장

Data: 전역 변수 저장

Heap: 동적 변수 저장

Stack: 함수, 지역 변수 저장

- 함수가 실행되면 해당 함수가 실행될 환경이 stack에 쌓이는데, 위에서부터 꺼내져서 CPU가 실행시킴

## 싱글 스레드와 멀티 스레드

![image-20230222223916455](%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%EC%99%80%20%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4,%EC%8A%A4%EB%A0%88%EB%93%9C.assets/image-20230222223916455-16770731584513.png)

### 싱글 스레드

하나의 프로세스에서 하나의 스레드를 실행한다. 

하나의 레지스터와 스택으로 표현

#### 싱글 스레드의 장점

- 자원 접근에 대한 동기화를 신경쓰지 않아도 된다.

- 여러개의 스레드가 공유된 자원을 사용할 경우, 각 스레드가 원하는 결과를 얻게 하려면 공용 자원에 대한 접근이 통제되어야 하며, 이 작업은 프로그래머에게 많은 노력을 요구하고 많은 비용을 발생시킨다. 단일 스레드 모델에서는 이러한 작업이 필요하지 않다.

- 작업 전환 작업을 요구하지 않는다.

- 작업 전환은 여러 개의 프로세스가 하나의 프로세서를 공유할 때 발생하는 작업으로 많은 비용을 필요로 한다.

#### 싱글 스레드의 단점

- 여러개의 CPU를 활용하지 못한다.

- 프로세서를 최대한 활용하게 하려면 cluster 모듈을 사용하거나, 외부에서 여러 개의 프로그램 인스턴스를 실행시키는 방법을 사용해야 한다.
- 두 개의 작업을 하나의 스레드로 처리하는 경우와, 두 개의 스레드로 처리하는 경우를 가정했을 때, 후자의 경우는 짧은 시간 동안 2개의 스레드가 번갈아가면서 작업을 수행한다. 그래서 동시에 두 작업이 처리되는 것과 같이 느끼게 된다.
- 하지만 오히려 두 개의 스레드로 작업한 시간이 싱글 스레드로 작업한 시간보다 더 걸릴 수도 있는데, 그 이유는 스레드 간의 작업 전환(context switching)에 시간이 걸리기 때문
- 따라서 단순히 CPU만을 사용하는 계산 작업이라면, 오히려 멀티스레드보다 싱글스레드로 프로그래밍 하는 것이 더 효율적이다.

### 멀티 스레드

프로그램을 다수의 실행 단위로 나누어 실행한다.

프로세스 내에서 자원을 공유하여 자원 생성과 관리의 중복을 최소화한다.

서버가 많은 요청을 효율적으로 수행할 수 있는 환경을 제공한다.

각각의 스레드가 고유의 레지스터와 스택으로 표현된다.

#### 멀티 스레드의 장점

- 새로운 프로세스를 생성하는 것보다 기존 프로세스에서 스레드를 생성하는 것이 빠르다.
- 프로세스의 자원과 상태를 공유하여 효율적으로 운영이 가능하다.
- 프로세스의 작업 전환보다 스레드의 작업 전환이 더 빠르다.

#### 멀티 스레드의 단점

- 하나의 스레드만 실행중일 때는 실행시간이 오히려 지연될 수 있다.
- 멀티스레딩을 위해 운영체제의 지원이 필요하다,
- 스레드 스케쥴링을 신경써야 한다.



## 프로세스와 스레드의 차이

프로그램 > 프로세스 > 스레드 : 개념의 범위부터 다르다. 스레드는 프로세스 안에 포함되어 있음.

- 프로세스는 프로그램을 실행하는 순간 해당 파일이 컴퓨터 메모리에 올라가게 되고, 이 동적인 상태의 프로그램을 프로세스라고 한다. 
- 스레드는 프로세스를 구성하는 더 작은 실행 단위의 개념이다.
- 프로세스는 메모리에 올라갈 때 운영체제로부터 독자적인 시스템 자원을 할당 받는 반면, 스레드는 프로세스 내부에서 다른 메모리 영역을 같은 프로세스 내 다른 스레드와 공유한다.

프로세스는 운영체제로부터 자원을 할당받는 **작업의 단위**이고, 스레드는 프로세스가 할당받은 자원을 이용하는 **실행 단위**이다. 

멀티프로세싱보다 멀티스레딩을 하는 이유는 운영체제로부터 자원을 할당하는 프로세싱 작업을 많이 하는 것보다 스레딩을 여러 개 하는 것이 훨씬 더 시스템 자원을 효율적으로 관리할 수 있기 때문이다.



## 브라우저에서는? (크롬기준)

- 크롬은 1탭-1프로세스이다. (다중 프로세스 지원)
- 프로세스는 메모리 영역이 독립적으로 할당된다.
- 프로세스간에는 메모리 영역을 침범하지 않는다.
- 위의 이유로 프로세스가 강제 종료 되어도 다른 프로세스에는 영향을 끼치지 않는다.
  - 크롬의 탭 중 하나가 강제 종료 혹은 실행 중지되어도 다른 탭에는 영향이 없다.